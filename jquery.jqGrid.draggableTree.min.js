$.jgrid.extend({_draggableTr:function(a){var b=this,c=this[0],d=c;$(a).draggable({helper:function(a){var b=$("<div class='ui-jqgrid'><table class='ui-jqgrid-btable'></table></div>"),c=$(a.currentTarget).clone().removeAttr("id");return c.find(".tree-wrap").remove(),b.find("table").append(c),console.log(b[0]),b[0]},opacity:.7,appendTo:"body",cursorAt:{top:0,left:-20},start:function(){}}).droppable({drop:function(a,e){var f=$(a.target).attr("id"),g=$(d).jqGrid("getLocalRow",f),h=$(d).jqGrid("getLocalRow",e.draggable.prop("id"));console.log("parentid "+f);var i=$(d).jqGrid("getGridParam","treeReader"),j=$(d).jqGrid("getGridParam","treedatatype");if("local"==j&&0!=h[i.leaf_field]){if($(d).jqGrid("delTreeNode",e.draggable.prop("id")),1==g[i.leaf_field]){var k=$(d).jqGrid("getNodeParent",g);console.log("is leaf  "+k._id_),$(d).jqGrid("addChildNode",e.draggable.prop("id"),k._id_,h)}else console.log("is not leaf"),$(d).jqGrid("addChildNode",e.draggable.prop("id"),f,h);b._draggableTr($("#"+$.jgrid.jqID(e.draggable.prop("id")))),c.p.onDroppedRow&&$.isFunction(c.p.onDroppedRow)&&c.p.onDroppedRow.call(c,e.draggable.prop("id"),a)}}})},draggableTree:function(){var a=this,b=this[0];$("tr",b).each(function(){a._draggableTr(this)}),$(this).on("jqGridLoadComplete",function(){$("tr",b).each(function(){a._draggableTr(this)})})}});